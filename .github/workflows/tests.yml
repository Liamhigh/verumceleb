name: Manual Tests (Jest)

on:
  workflow_dispatch:

jobs:
  tests:
    runs-on: ubuntu-24.04
    timeout-minutes: 30
    continue-on-error: true
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'

      # install if package.json exists
      - name: Install
        run: |
          if [ -f package.json ]; then
            npm ci || npm install
          else
            echo "No Node project"; exit 0
          fi

      # bump Jest timeout to 30s at runtime (non-destructive)
      - name: Increase Jest timeout
        if: exists('package.json')
        run: |
          node -e "try{const fs=require('fs');const p=JSON.parse(fs.readFileSync('package.json'));p.jest=p.jest||{};p.jest.testTimeout=30000;fs.writeFileSync('package.json',JSON.stringify(p,null,2));console.log('Set testTimeout=30000')}catch(e){console.log('Skip: no package.json')}"
      
      - name: Run tests
        if: exists('package.json')
        run: npm test --if-present
