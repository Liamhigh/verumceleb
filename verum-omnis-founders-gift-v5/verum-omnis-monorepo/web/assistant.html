<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Verum Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-slate-100 max-w-3xl mx-auto p-6">
  <h1 class="text-2xl font-semibold mb-3">Verum Assistant</h1>
  <p class="mb-4 text-slate-300">Upload a file to generate a SHA-512 hash locally. Use this hash in notices & proofs.</p>

  <input id="file" type="file" class="mb-4" accept=".pdf,.doc,.docx,.txt,image/*,audio/*,video/*"/>
  <div class="space-x-2 mb-3">
    <button id="btn-verify" class="px-3 py-2 rounded bg-indigo-600 hover:bg-indigo-500">Check this document</button>
    <button id="btn-seal" class="px-3 py-2 rounded border border-slate-700 hover:bg-slate-800">Seal this document</button>
    <button id="btn-anchor" class="px-3 py-2 rounded border border-slate-700 hover:bg-slate-800">Anchor this document</button>
  </div>
  <pre id="out" class="p-3 rounded bg-slate-900 border border-slate-800 whitespace-pre-wrap"></pre>

  <script>
    let currentHash = null;
    let currentFile = null;

    async function sha512(buf){
      const d = await crypto.subtle.digest('SHA-512', buf);
      return [...new Uint8Array(d)].map(b=>b.toString(16).padStart(2,'0')).join('');
    }

    document.getElementById('file').addEventListener('change', async (e)=>{
      const f = e.target.files?.[0]; if(!f) return;
      currentFile = f;
      const buf = await f.arrayBuffer();
      const h = await sha512(buf);
      currentHash = h;
      document.getElementById('out').textContent = `I've hashed your file (SHA-512): ${h}\nWhat next?`;
    });

    async function callApi(path, body){
      const res = await fetch('/api' + path, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(body)
      });
      const json = await res.json().catch(() => ({
        error: 'Unable to parse server response. Please try again.'
      }));
      return {status: res.status, json};
    }

    document.getElementById('btn-verify').addEventListener('click', async()=>{
      if(!currentHash) return alert('Upload a file first to compute SHA-512.');
      const r = await callApi('/verify', { sha512: currentHash });
      document.getElementById('out').textContent += `\n\nVerify → ${JSON.stringify(r.json, null, 2)}`;
    });

    document.getElementById('btn-seal').addEventListener('click', async()=>{
      if(!currentHash) return alert('Upload a file first to compute SHA-512.');
      const r = await callApi('/seal', { sha512: currentHash, filename: currentFile?.name });
      document.getElementById('out').textContent += `\n\nSeal → ${JSON.stringify(r.json, null, 2)}`;
    });

    document.getElementById('btn-anchor').addEventListener('click', async()=>{
      if(!currentHash) return alert('Upload a file first to compute SHA-512.');
      const r = await callApi('/anchor', { sha512: currentHash });
      document.getElementById('out').textContent += `\n\nAnchor → ${JSON.stringify(r.json, null, 2)}`;
    });
  </script>
</body>
</html>
