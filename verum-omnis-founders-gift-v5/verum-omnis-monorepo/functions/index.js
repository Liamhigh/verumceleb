"use strict";var ee=Object.create;var l=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var oe=Object.getOwnPropertyNames;var re=Object.getPrototypeOf,se=Object.prototype.hasOwnProperty;var ne=(t,e)=>{for(var o in e)l(t,o,{get:e[o],enumerable:!0})},y=(t,e,o,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of oe(e))!se.call(t,s)&&s!==o&&l(t,s,{get:()=>e[s],enumerable:!(r=te(e,s))||r.enumerable});return t};var c=(t,e,o)=>(o=t!=null?ee(re(t)):{},y(e||!t||!t.__esModule?l(o,"default",{value:t,enumerable:!0}):o,t)),ie=t=>y(l({},"__esModule",{value:!0}),t);var le={};ne(le,{api:()=>_e,app:()=>a});module.exports=ie(le);var $=require("firebase-functions/v2/https"),A=c(require("express"),1),M=c(require("cors"),1),Z=c(require("helmet"),1),G=c(require("compression"),1),X=c(require("express-rate-limit"),1),Q=c(require("pino"),1);function C(t){let e=process.env.FIREBASE_APP_ENV||"local",o={OPENAI_API_KEY:process.env.OPENAI_API_KEY,DEEPSEEK_API_KEY:process.env.DEEPSEEK_API_KEY,ANTHROPIC_API_KEY:process.env.ANTHROPIC_API_KEY,FIREBASE_PROJECT_ID:process.env.FIREBASE_PROJECT_ID||process.env.GCLOUD_PROJECT,FIREBASE_APP_ENV:e,ANCHOR_RPC_URL:process.env.ANCHOR_RPC_URL,ANCHOR_PRIVATE_KEY:process.env.ANCHOR_PRIVATE_KEY};return t.info({env:o.FIREBASE_APP_ENV,project:o.FIREBASE_PROJECT_ID||"unknown",secrets:{OPENAI_API_KEY:!!o.OPENAI_API_KEY,DEEPSEEK_API_KEY:!!o.DEEPSEEK_API_KEY,ANTHROPIC_API_KEY:!!o.ANTHROPIC_API_KEY,ANCHOR_RPC_URL:!!o.ANCHOR_RPC_URL,ANCHOR_PRIVATE_KEY:!!o.ANCHOR_PRIVATE_KEY}},"Environment configuration loaded"),o}function R(){return{OPENAI_API_KEY:process.env.OPENAI_API_KEY,DEEPSEEK_API_KEY:process.env.DEEPSEEK_API_KEY,ANTHROPIC_API_KEY:process.env.ANTHROPIC_API_KEY,FIREBASE_PROJECT_ID:process.env.FIREBASE_PROJECT_ID||process.env.GCLOUD_PROJECT,FIREBASE_APP_ENV:process.env.FIREBASE_APP_ENV||"local",ANCHOR_RPC_URL:process.env.ANCHOR_RPC_URL,ANCHOR_PRIVATE_KEY:process.env.ANCHOR_PRIVATE_KEY}}var h=class extends Error{constructor(o,r,s){super(o);this.code=o;this.httpStatus=r;this.details=s;this.name="VoError"}};function p(t,e,o){return new h(t,e,o)}function N(t){return(e,o,r,s)=>{e instanceof h?(t.error({code:e.code,status:e.httpStatus,details:e.details,path:o.path},"Application error"),r.status(e.httpStatus).json({ok:!1,error:e.code,message:e.message,...e.details&&{details:e.details}})):(t.error({error:e.message,stack:e.stack,path:o.path},"Unexpected error"),r.status(500).json({ok:!1,error:"VO_E_INTERNAL",message:"Internal server error"}))}}var x=require("express");function S(t){let e=(0,x.Router)(),o=Date.now();return e.get("/",(r,s)=>{let n=R(),E=Math.floor((Date.now()-o)/1e3);s.status(200).json({ok:!0,status:"healthy",service:"verum-omnis-api",env:n.FIREBASE_APP_ENV,uptime:E,versions:{node:process.version}})}),e}var q=require("express");var K=require("express"),P=require("zod");var b=require("zod");function i(t){return(e,o,r)=>{try{let s=t.parse(e.body);e.body=s,r()}catch(s){if(s instanceof b.z.ZodError)throw p("VO_E_INPUT",400,{errors:s.errors});r(s)}}}function u(t){return/^[a-f0-9]{128}$/i.test(t||"")}var ae=P.z.object({sha512:P.z.string().refine(u,"sha512 must be a 128-character hexadecimal string")});function L(t){let e=(0,K.Router)();return e.get("/",(o,r)=>{r.json({ok:!0})}),e.post("/",i(ae),(o,r)=>{let{sha512:s}=o.body;t.info({sha512:s.substring(0,16)+"..."},"Verify request"),r.json({ok:!0,checked:!0,sha512:s,findings:[],verdict:"ok"})}),e}var T=require("express"),f=require("zod");var pe=f.z.object({sha512:f.z.string().refine(u,"sha512 must be a 128-character hexadecimal string"),filename:f.z.string().optional(),title:f.z.string().optional()});function H(t){let e=(0,T.Router)();return e.post("/",i(pe),(o,r)=>{let{sha512:s,filename:n,title:E}=o.body;t.info({sha512:s.substring(0,16)+"...",filename:n,title:E},"Seal request"),r.json({ok:!0,sealed:!0,sha512:s,filename:n||null,title:E||null,pdf:"base64:TODO"})}),e}var Y=require("express"),d=require("zod");var ce=d.z.object({items:d.z.array(d.z.string()).min(2).max(100)});function k(t){let e=(0,Y.Router)();return e.post("/",i(ce),(o,r)=>{let{items:s}=o.body;t.info({itemCount:s.length},"Contradict request"),r.json({ok:!0,contradictions:[],summary:`Analyzed ${s.length} statements. No contradictions detected.`})}),e}var j=require("express"),g=require("zod");var ue=g.z.object({sha512:g.z.string().refine(u,"sha512 must be a 128-character hexadecimal string").optional(),hash:g.z.string().optional()}).refine(t=>t.sha512||t.hash,{message:"Either sha512 or hash must be provided"});function V(t){let e=(0,j.Router)();return e.post("/",i(ue),(o,r)=>{let s=o.body.sha512||o.body.hash,n=R();t.info({hash:s.substring(0,16)+"..."},"Anchor request"),n.ANCHOR_RPC_URL&&n.ANCHOR_PRIVATE_KEY?r.json({ok:!0,anchored:!0,sha512:s,tx:"0xTODO_ACTUAL_TX_HASH",status:"live"}):r.json({ok:!0,anchored:!0,sha512:s,tx:"0xMOCK",status:"dry-run"})}),e}var D=require("express"),_=require("zod");var w=new Map,me=_.z.object({mode:_.z.enum(["verify","policy","anchor","receipt","notice","seal"]).optional(),hash:_.z.string().optional(),message:_.z.string().optional()});function F(t){let e=(0,D.Router)();return e.post("/",i(me),(o,r)=>{let{mode:s,hash:n,message:E}=o.body;if(!s)throw p("invalid_mode",400,{message:"mode is required"});switch(t.info({mode:s,hasHash:!!n},"Assistant request"),s){case"verify":r.json({ok:!0,pack:"founders-release"});break;case"policy":r.json({ok:!0,constitution:"Constitutional AI principles apply",manifest:{version:"1.0.0",principles:["Truth","Accuracy","Transparency"]}});break;case"anchor":if(!n)throw p("hash_required_for_anchor",400);let I={hash:n,timestamp:new Date().toISOString(),tx:"0xMOCK"};w.set(n,I),r.json({ok:!0,hash:n,receipt:I});break;case"receipt":if(!n)throw p("hash_required_for_receipt",400);let O=w.get(n);if(!O)throw p("receipt_not_found",404);r.json({ok:!0,receipt:O});break;case"notice":r.json({ok:!0,notice:{citizen:"Free forever for individual citizens",institution:"Institutions and companies pay 20% of recovered fraud amount after successful trial"}});break;case"seal":r.json({ok:!0,sealed:!0,message:"Seal functionality available via /v1/seal endpoint"});break;default:throw p("invalid_mode",400,{mode:s})}}),e}function B(t){let e=(0,q.Router)();return e.use("/verify",L(t)),e.use("/seal",H(t)),e.use("/contradict",k(t)),e.use("/anchor",V(t)),e.use("/assistant",F(t)),e}var U=require("express"),v=require("zod");var Ee=v.z.object({message:v.z.string().min(1).max(1e4)});function z(t){let e=(0,U.Router)();return e.post("/",i(Ee),(o,r)=>{let{message:s}=o.body;t.info({messageLength:s.length},"Chat message received"),r.json({ok:!0,reply:`Hello! You said: ${s}`})}),e}function J(t,e){t.use("/health",S(e)),t.use("/chat",z(e)),t.use("/v1",B(e)),t.use((o,r)=>{r.status(404).json({ok:!1,error:"VO_E_NOT_FOUND",message:`Route ${o.method} ${o.path} not found`})})}var m=(0,Q.default)({level:process.env.FIREBASE_APP_ENV==="prod"?"info":"debug",transport:process.env.FIREBASE_APP_ENV!=="prod"?{target:"pino-pretty",options:{colorize:!0}}:void 0});C(m);var a=(0,A.default)();a.use((0,Z.default)({crossOriginResourcePolicy:!1,contentSecurityPolicy:!1}));a.use((0,G.default)());var W=["https://verumglobal.foundation","https://gitverum.web.app","https://verumdone.web.app",/^https:\/\/.*\.web\.app$/,/^https:\/\/.*\.firebaseapp\.com$/];process.env.NODE_ENV!=="prod"&&W.push("http://localhost:5173","http://127.0.0.1:5173");a.use((0,M.default)({origin:(t,e)=>{if(!t)return e(null,!0);W.some(r=>typeof r=="string"?r===t:r.test(t))?e(null,!0):(m.warn({origin:t},"CORS rejected origin"),e(new Error("Not allowed by CORS")))},credentials:!0}));a.use(A.default.json({limit:"2mb"}));a.use(A.default.urlencoded({extended:!0,limit:"2mb"}));var fe=(0,X.default)({windowMs:60*1e3,max:60,standardHeaders:!0,legacyHeaders:!1,handler:(t,e)=>{m.warn({ip:t.ip},"Rate limit exceeded"),e.status(429).json({ok:!1,error:"VO_E_RATE_LIMIT",message:"Too many requests, please try again later"})}});a.use(fe);a.use((t,e,o)=>{let r=Date.now();e.on("finish",()=>{let s=Date.now()-r;m.info({method:t.method,path:t.path,status:e.statusCode,duration:s,ip:t.ip})}),o()});J(a,m);a.use(N(m));var _e=(0,$.onRequest)(a);0&&(module.exports={api,app});
//# sourceMappingURL=index.cjs.map