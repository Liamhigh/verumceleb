"use strict";var Q=Object.create;var l=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var te=Object.getPrototypeOf,oe=Object.prototype.hasOwnProperty;var re=(t,e)=>{for(var o in e)l(t,o,{get:e[o],enumerable:!0})},I=(t,e,o,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ee(e))!oe.call(t,s)&&s!==o&&l(t,s,{get:()=>e[s],enumerable:!(r=W(e,s))||r.enumerable});return t};var u=(t,e,o)=>(o=t!=null?Q(te(t)):{},I(e||!t||!t.__esModule?l(o,"default",{value:t,enumerable:!0}):o,t)),se=t=>I(l({},"__esModule",{value:!0}),t);var fe={};re(fe,{api:()=>Ee,app:()=>a});module.exports=se(fe);var z=require("firebase-functions/v2/https"),A=u(require("express"),1),J=u(require("cors"),1),$=u(require("helmet"),1),M=u(require("compression"),1),Z=u(require("express-rate-limit"),1),G=u(require("pino"),1);function O(t){let e=process.env.FIREBASE_APP_ENV||"local",o={OPENAI_API_KEY:process.env.OPENAI_API_KEY,DEEPSEEK_API_KEY:process.env.DEEPSEEK_API_KEY,ANTHROPIC_API_KEY:process.env.ANTHROPIC_API_KEY,FIREBASE_PROJECT_ID:process.env.FIREBASE_PROJECT_ID||process.env.GCLOUD_PROJECT,FIREBASE_APP_ENV:e,ANCHOR_RPC_URL:process.env.ANCHOR_RPC_URL,ANCHOR_PRIVATE_KEY:process.env.ANCHOR_PRIVATE_KEY};return t.info({env:o.FIREBASE_APP_ENV,project:o.FIREBASE_PROJECT_ID||"unknown",secrets:{OPENAI_API_KEY:!!o.OPENAI_API_KEY,DEEPSEEK_API_KEY:!!o.DEEPSEEK_API_KEY,ANTHROPIC_API_KEY:!!o.ANTHROPIC_API_KEY,ANCHOR_RPC_URL:!!o.ANCHOR_RPC_URL,ANCHOR_PRIVATE_KEY:!!o.ANCHOR_PRIVATE_KEY}},"Environment configuration loaded"),o}function R(){return{OPENAI_API_KEY:process.env.OPENAI_API_KEY,DEEPSEEK_API_KEY:process.env.DEEPSEEK_API_KEY,ANTHROPIC_API_KEY:process.env.ANTHROPIC_API_KEY,FIREBASE_PROJECT_ID:process.env.FIREBASE_PROJECT_ID||process.env.GCLOUD_PROJECT,FIREBASE_APP_ENV:process.env.FIREBASE_APP_ENV||"local",ANCHOR_RPC_URL:process.env.ANCHOR_RPC_URL,ANCHOR_PRIVATE_KEY:process.env.ANCHOR_PRIVATE_KEY}}var d=class extends Error{constructor(o,r,s){super(o);this.code=o;this.httpStatus=r;this.details=s;this.name="VoError"}};function c(t,e,o){return new d(t,e,o)}function C(t){return(e,o,r,s)=>{e instanceof d?(t.error({code:e.code,status:e.httpStatus,details:e.details,path:o.path},"Application error"),r.status(e.httpStatus).json({ok:!1,error:e.code,message:e.message,...e.details&&{details:e.details}})):(t.error({error:e.message,stack:e.stack,path:o.path},"Unexpected error"),r.status(500).json({ok:!1,error:"VO_E_INTERNAL",message:"Internal server error"}))}}var N=require("express");function y(t){let e=(0,N.Router)(),o=Date.now();return e.get("/",(r,s)=>{let n=R(),p=Math.floor((Date.now()-o)/1e3);s.status(200).json({ok:!0,status:"healthy",service:"verum-omnis-api",env:n.FIREBASE_APP_ENV,uptime:p,versions:{node:process.version}})}),e}var F=require("express");var S=require("express"),P=require("zod");var x=require("zod");function i(t){return(e,o,r)=>{try{let s=t.parse(e.body);e.body=s,r()}catch(s){if(s instanceof x.z.ZodError)throw c("VO_E_INPUT",400,{errors:s.errors});r(s)}}}function m(t){return/^[a-f0-9]{128}$/i.test(t||"")}var ne=P.z.object({sha512:P.z.string().refine(m,"sha512 must be a 128-character hexadecimal string")});function b(t){let e=(0,S.Router)();return e.get("/",(o,r)=>{r.json({ok:!0})}),e.post("/",i(ne),(o,r)=>{let{sha512:s}=o.body;r.json({ok:!0,checked:!0,sha512:s,findings:[],verdict:"ok"})}),e}var K=require("express"),f=require("zod");var ie=f.z.object({sha512:f.z.string().refine(m,"sha512 must be a 128-character hexadecimal string"),filename:f.z.string().optional(),title:f.z.string().optional()});function L(t){let e=(0,K.Router)();return e.post("/",i(ie),(o,r)=>{let{sha512:s,filename:n,title:p}=o.body;t.info({sha512:s.substring(0,16)+"...",filename:n,title:p},"Seal request"),r.json({ok:!0,sealed:!0,sha512:s,filename:n||null,title:p||null,pdf:"base64:TODO"})}),e}var T=require("express"),h=require("zod");var ae=h.z.object({items:h.z.array(h.z.string()).min(2).max(100)});function k(t){let e=(0,T.Router)();return e.post("/",i(ae),(o,r)=>{let{items:s}=o.body;t.info({itemCount:s.length},"Contradict request"),r.json({ok:!0,contradictions:[],summary:`Analyzed ${s.length} statements. No contradictions detected.`})}),e}var H=require("express"),g=require("zod");var pe=g.z.object({sha512:g.z.string().refine(m,"sha512 must be a 128-character hexadecimal string").optional(),hash:g.z.string().optional()}).refine(t=>t.sha512||t.hash,{message:"Either sha512 or hash must be provided"});function Y(t){let e=(0,H.Router)();return e.post("/",i(pe),(o,r)=>{let s=o.body.sha512||o.body.hash,n=R();t.info({hash:s.substring(0,16)+"..."},"Anchor request"),n.ANCHOR_RPC_URL&&n.ANCHOR_PRIVATE_KEY?r.json({ok:!0,anchored:!0,sha512:s,tx:"0xTODO_ACTUAL_TX_HASH",status:"live"}):r.json({ok:!0,anchored:!0,sha512:s,tx:"0xMOCK",status:"dry-run"})}),e}var j=require("express"),_=require("zod");var w=new Map,ce=_.z.object({mode:_.z.enum(["verify","policy","anchor","receipt","notice","seal"]).optional(),hash:_.z.string().optional(),message:_.z.string().optional()});function D(t){let e=(0,j.Router)();return e.post("/",i(ce),(o,r)=>{let{mode:s,hash:n}=o.body;if(!s)throw c("invalid_mode",400,{message:"mode is required"});switch(t.info({mode:s,hasHash:!!n},"Assistant request"),s){case"verify":r.json({ok:!0,pack:"founders-release"});break;case"policy":r.json({ok:!0,constitution:"Constitutional AI principles apply",manifest:{version:"1.0.0",principles:["Truth","Accuracy","Transparency"]}});break;case"anchor":{if(!n)throw c("hash_required_for_anchor",400);let p={hash:n,timestamp:new Date().toISOString(),tx:"0xMOCK"};w.set(n,p),r.json({ok:!0,hash:n,receipt:p});break}case"receipt":{if(!n)throw c("hash_required_for_receipt",400);let p=w.get(n);if(!p)throw c("receipt_not_found",404);r.json({ok:!0,receipt:p});break}case"notice":r.json({ok:!0,notice:{citizen:"Free forever for individual citizens",institution:"Institutions and companies pay 20% of recovered fraud amount after successful trial"}});break;case"seal":r.json({ok:!0,sealed:!0,message:"Seal functionality available via /v1/seal endpoint"});break;default:throw c("invalid_mode",400,{mode:s})}}),e}function V(t){let e=(0,F.Router)();return e.use("/verify",b(t)),e.use("/seal",L(t)),e.use("/contradict",k(t)),e.use("/anchor",Y(t)),e.use("/assistant",D(t)),e}var q=require("express"),v=require("zod");var ue=v.z.object({message:v.z.string().min(1).max(1e4)});function B(t){let e=(0,q.Router)();return e.post("/",i(ue),(o,r)=>{let{message:s}=o.body;r.json({ok:!0,reply:`Hello! You said: ${s}`})}),e}function U(t,e){t.use("/health",y(e)),t.use("/chat",B(e)),t.use("/v1",V(e)),t.use((o,r)=>{r.status(404).json({ok:!1,error:"VO_E_NOT_FOUND",message:`Route ${o.method} ${o.path} not found`})})}var E=(0,G.default)({level:process.env.FIREBASE_APP_ENV==="prod"?"info":"debug",transport:process.env.FIREBASE_APP_ENV!=="prod"?{target:"pino-pretty",options:{colorize:!0}}:void 0});O(E);var a=(0,A.default)();a.use((0,$.default)({crossOriginResourcePolicy:!1,contentSecurityPolicy:!1}));a.use((0,M.default)());var X=["https://verumglobal.foundation","https://gitverum.web.app","https://verumdone.web.app",/^https:\/\/.*\.web\.app$/,/^https:\/\/.*\.firebaseapp\.com$/];process.env.NODE_ENV!=="prod"&&X.push("http://localhost:5173","http://127.0.0.1:5173");a.use((0,J.default)({origin:(t,e)=>{if(!t)return e(null,!0);X.some(r=>typeof r=="string"?r===t:r.test(t))?e(null,!0):(E.warn({origin:t},"CORS rejected origin"),e(new Error("Not allowed by CORS")))},credentials:!0}));a.use(A.default.json({limit:"2mb"}));a.use(A.default.urlencoded({extended:!0,limit:"2mb"}));var me=(0,Z.default)({windowMs:60*1e3,max:60,standardHeaders:!0,legacyHeaders:!1,handler:(t,e)=>{E.warn({ip:t.ip},"Rate limit exceeded"),e.status(429).json({ok:!1,error:"VO_E_RATE_LIMIT",message:"Too many requests, please try again later"})}});a.use(me);a.use((t,e,o)=>{let r=Date.now();e.on("finish",()=>{let s=Date.now()-r;E.info({method:t.method,path:t.path,status:e.statusCode,duration:s,ip:t.ip})}),o()});U(a,E);a.use(C(E));var Ee=(0,z.onRequest)(a);0&&(module.exports={api,app});
//# sourceMappingURL=index.cjs.map