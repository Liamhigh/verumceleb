<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Verify Evidence ‚Ä¢ Verum Omnis</title>
<link rel="stylesheet" href="/assets/app.css"/>
<style>
.verify-container {
  max-width: 800px;
  margin: 0 auto;
  padding: 40px 24px;
}

.verify-header {
  text-align: center;
  margin-bottom: 48px;
}

.verify-title {
  font-size: 32px;
  font-weight: 600;
  margin-bottom: 12px;
  color: var(--text);
}

.verify-subtitle {
  color: var(--muted);
  font-size: 18px;
}

.upload-section {
  background: var(--surface);
  border: 2px dashed var(--border);
  border-radius: 12px;
  padding: 48px 24px;
  text-align: center;
  margin-bottom: 32px;
  transition: border-color 0.2s ease;
}

.upload-section:hover {
  border-color: var(--accent);
}

.upload-section.dragover {
  border-color: var(--accent);
  background: rgba(77, 163, 255, 0.1);
}

.upload-icon {
  font-size: 48px;
  margin-bottom: 16px;
  color: var(--muted);
}

.upload-text {
  font-size: 18px;
  margin-bottom: 16px;
  color: var(--text);
}

.upload-hint {
  color: var(--muted);
  font-size: 14px;
  margin-bottom: 24px;
}

.file-input {
  display: none;
}

.upload-button {
  background: var(--accent);
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.2s ease;
}

.upload-button:hover {
  background: #3d8bef;
}

.text-input-section {
  margin-bottom: 32px;
}

.text-input {
  width: 100%;
  min-height: 120px;
  padding: 16px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: var(--surface);
  color: var(--text);
  font-family: var(--font-base);
  font-size: 16px;
  resize: vertical;
}

.text-input:focus {
  outline: none;
  border-color: var(--accent);
}

.hash-section {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px;
  margin-bottom: 32px;
}

.hash-input {
  width: 100%;
  padding: 12px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: var(--bg);
  color: var(--text);
  font-family: monospace;
  font-size: 14px;
  margin-bottom: 16px;
}

.action-buttons {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.btn {
  padding: 12px 24px;
  border-radius: 8px;
  border: none;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  min-width: 120px;
}

.btn-primary {
  background: var(--accent);
  color: white;
}

.btn-primary:hover {
  background: #3d8bef;
}

.btn-secondary {
  background: transparent;
  color: var(--text);
  border: 1px solid var(--border);
}

.btn-secondary:hover {
  border-color: var(--accent);
  color: var(--accent);
}

.output {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 16px;
  margin-top: 24px;
  font-family: monospace;
  font-size: 14px;
  white-space: pre-wrap;
  color: var(--text);
  max-height: 400px;
  overflow-y: auto;
}

.progress {
  margin: 24px 0;
}

.progress-bar {
  width: 100%;
  height: 8px;
  background: var(--border);
  border-radius: 4px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: var(--accent);
  border-radius: 4px;
  transition: width 0.3s ease;
}

.status-chips {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin: 16px 0;
}

.chip {
  padding: 6px 12px;
  border-radius: 16px;
  font-size: 12px;
  font-weight: 500;
  background: var(--surface);
  border: 1px solid var(--border);
  color: var(--muted);
}

.chip.active {
  background: var(--accent);
  color: white;
  border-color: var(--accent);
}

.chip.success {
  background: var(--success);
  color: white;
  border-color: var(--success);
}
</style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container">
      <div class="nav">
        <a href="/">
          <img src="/assets/logo_white.png" alt="Verum Omnis" class="logo"/>
        </a>
        <nav class="nav-links">
          <a href="/">Home</a>
          <a href="/legal.html">Legal & Treaty</a>
        </nav>
      </div>
    </div>
  </header>

  <div class="verify-container">
    <!-- Header -->
    <div class="verify-header">
      <h1 class="verify-title">Verify Evidence</h1>
      <p class="verify-subtitle">Upload files or paste text to check for contradictions and seal with cryptographic proof</p>
    </div>

    <!-- File Upload Section -->
    <div class="upload-section" id="uploadSection">
      <div class="upload-icon">üìÅ</div>
      <div class="upload-text">Drop files here or click to upload</div>
      <div class="upload-hint">
        Supported: PDF, DOCX, ODT, TXT, CSV, XLSX, PPTX, PNG, JPG, WEBP, TIFF, MP4, MOV, WEBM, WAV, MP3, M4A, FLAC<br>
        Max 250 MB per file ‚Ä¢ Batch up to 1 GB
      </div>
      <button class="upload-button" onclick="document.getElementById('fileInput').click()">
        Choose Files
      </button>
      <input type="file" id="fileInput" class="file-input" multiple accept=".pdf,.docx,.odt,.txt,.csv,.xlsx,.pptx,.png,.jpg,.jpeg,.webp,.tiff,.mp4,.mov,.webm,.wav,.mp3,.m4a,.flac">
    </div>

    <!-- Text Input Section -->
    <div class="text-input-section">
      <h3>Or paste text to analyze:</h3>
      <textarea id="textInput" class="text-input" placeholder="Paste text to scan for contradictions, metadata inconsistencies, and policy violations..."></textarea>
      <div class="action-buttons">
        <button class="btn btn-primary" onclick="analyzeText()">Run Checks</button>
        <button class="btn btn-secondary" onclick="clearText()">Clear</button>
      </div>
    </div>

    <!-- Progress Section -->
    <div class="progress" id="progressSection" style="display: none;">
      <div class="status-chips" id="statusChips">
        <div class="chip">Hashing</div>
        <div class="chip">Metadata scan</div>
        <div class="chip">Consistency check</div>
        <div class="chip">Image/Video forensics</div>
        <div class="chip">Policy diff</div>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
      </div>
    </div>

    <!-- Hash Section -->
    <div class="hash-section">
      <h3>Direct Hash Operations</h3>
      <input id="hashInput" class="hash-input" placeholder="Enter SHA-512 hash (128 hex characters)"/>
      <div class="action-buttons">
        <button class="btn btn-primary" onclick="verifySystem()">Verify System</button>
        <button class="btn btn-secondary" onclick="anchorHash()">Anchor Hash</button>
        <button class="btn btn-secondary" onclick="sealPDF()">Seal ‚Üí PDF</button>
      </div>
    </div>

    <!-- Output -->
    <div id="output" class="output" style="display: none;"></div>
  </div>

<script>
const BASE = location.origin + "/api";
const fileInput = document.getElementById('fileInput');
const uploadSection = document.getElementById('uploadSection');
const textInput = document.getElementById('textInput');
const hashInput = document.getElementById('hashInput');
const output = document.getElementById('output');
const progressSection = document.getElementById('progressSection');
const progressFill = document.getElementById('progressFill');
const statusChips = document.getElementById('statusChips');

// Drag and drop handlers
uploadSection.addEventListener('dragover', (e) => {
  e.preventDefault();
  uploadSection.classList.add('dragover');
});

uploadSection.addEventListener('dragleave', () => {
  uploadSection.classList.remove('dragover');
});

uploadSection.addEventListener('drop', (e) => {
  e.preventDefault();
  uploadSection.classList.remove('dragover');
  const files = Array.from(e.dataTransfer.files);
  handleFiles(files);
});

fileInput.addEventListener('change', (e) => {
  const files = Array.from(e.target.files);
  handleFiles(files);
});

// File handling
async function handleFiles(files) {
  showOutput('Processing files...');
  showProgress();
  
  for (let i = 0; i < files.length; i++) {
    const file = files[i];
    updateProgress(`Processing ${file.name}...`, (i / files.length) * 100);
    
    // Compute hash locally
    const hash = await computeFileHash(file);
    appendOutput(`\nüìÅ ${file.name} (${formatFileSize(file.size)})`);
    appendOutput(`üîë SHA-512: ${hash}`);
    
    // Update hash input with first file's hash
    if (i === 0) {
      hashInput.value = hash;
    }
    
    // Simulate analysis steps
    await simulateAnalysis();
  }
  
  hideProgress();
  appendOutput('\n‚úÖ Analysis complete. Use buttons below to seal or anchor.');
}

// Text analysis
async function analyzeText() {
  const text = textInput.value.trim();
  if (!text) {
    showOutput('Please enter some text to analyze.');
    return;
  }
  
  showOutput('Analyzing text...');
  showProgress();
  
  try {
    updateProgressStep('Metadata scan', 25);
    
    const response = await fetch(BASE + "/v1/contradict", {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({text, meta: {}, timeline: []})
    });
    
    updateProgressStep('Consistency check', 75);
    const result = await response.json();
    updateProgressStep('Policy diff', 100);
    
    hideProgress();
    showOutput(JSON.stringify(result, null, 2));
  } catch (error) {
    hideProgress();
    showOutput('Error: ' + error.message);
  }
}

// System verification
async function verifySystem() {
  showOutput('Verifying system...');
  try {
    const response = await fetch(BASE + "/v1/verify");
    const result = await response.json();
    showOutput(JSON.stringify(result, null, 2));
  } catch (error) {
    showOutput('Error: ' + error.message);
  }
}

// Hash operations
async function anchorHash() {
  const hash = hashInput.value.trim();
  if (!hash || hash.length !== 128) {
    showOutput('Please enter a valid SHA-512 hash (128 hex characters).');
    return;
  }
  
  showOutput('Anchoring hash...');
  try {
    const response = await fetch(BASE + "/v1/anchor", {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({hash})
    });
    const result = await response.json();
    showOutput(JSON.stringify(result, null, 2));
  } catch (error) {
    showOutput('Error: ' + error.message);
  }
}

async function sealPDF() {
  const hash = hashInput.value.trim();
  if (!hash || hash.length !== 128) {
    showOutput('Please enter a valid SHA-512 hash (128 hex characters).');
    return;
  }
  
  showOutput('Generating sealed PDF...');
  try {
    const response = await fetch(BASE + "/v1/seal", {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        hash,
        title: "Verum Omnis Evidence Seal",
        notes: "Founders Release - Cryptographically sealed evidence"
      })
    });
    
    if (response.ok) {
      const blob = await response.blob();
      const url = URL.createObjectURL(blob);
      window.open(url, "_blank");
      showOutput('‚úÖ Sealed PDF generated and opened in new tab.');
    } else {
      const error = await response.text();
      showOutput('Error generating PDF: ' + error);
    }
  } catch (error) {
    showOutput('Error: ' + error.message);
  }
}

// Utility functions
function clearText() {
  textInput.value = '';
  hideOutput();
}

function showOutput(text) {
  output.style.display = 'block';
  output.textContent = text;
}

function appendOutput(text) {
  output.textContent += text;
}

function hideOutput() {
  output.style.display = 'none';
}

function showProgress() {
  progressSection.style.display = 'block';
  progressFill.style.width = '0%';
  // Reset chips
  statusChips.querySelectorAll('.chip').forEach(chip => {
    chip.classList.remove('active', 'success');
  });
}

function hideProgress() {
  progressSection.style.display = 'none';
}

function updateProgress(text, percent) {
  progressFill.style.width = percent + '%';
}

function updateProgressStep(stepName, percent) {
  progressFill.style.width = percent + '%';
  
  // Update chips
  const chips = statusChips.querySelectorAll('.chip');
  chips.forEach(chip => {
    if (chip.textContent === stepName) {
      chip.classList.add('active');
    } else if (chip.classList.contains('active')) {
      chip.classList.remove('active');
      chip.classList.add('success');
    }
  });
}

// File utilities
async function computeFileHash(file) {
  const buffer = await file.arrayBuffer();
  const hashBuffer = await crypto.subtle.digest('SHA-512', buffer);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

function formatFileSize(bytes) {
  if (bytes === 0) return '0 B';
  const k = 1024;
  const sizes = ['B', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

async function simulateAnalysis() {
  // Simulate analysis steps for demo
  await new Promise(resolve => setTimeout(resolve, 500));
}

// Copy hash to clipboard when clicked
hashInput.addEventListener('click', () => {
  if (hashInput.value) {
    navigator.clipboard.writeText(hashInput.value);
    // Show brief feedback
    const originalPlaceholder = hashInput.placeholder;
    hashInput.placeholder = 'Copied to clipboard!';
    setTimeout(() => {
      hashInput.placeholder = originalPlaceholder;
    }, 1000);
  }
});
</script>
</body>
</html>
